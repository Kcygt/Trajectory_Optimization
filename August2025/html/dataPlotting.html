<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>dataPlotting</title>
<meta name="generator" content="MATLAB 24.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-08-14">
<meta name="DC.source" content="dataPlotting.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">close <span class="string">all</span>
<span class="comment">% publish('dataPlotting.m', 'html');</span>
<span class="keyword">for</span> i = 1:7
    <span class="comment">% Construct filenames</span>
    PdataFile = sprintf(<span class="string">'Pdata%d.mat'</span>, i);
    SdataFile = sprintf(<span class="string">'Sdata%d.mat'</span>, i);
    GdataFile = sprintf(<span class="string">'Gdata%d.mat'</span>, i);

    <span class="comment">% Check which files exist</span>
    hasPdata = exist(PdataFile, <span class="string">'file'</span>);
    hasSdata = exist(SdataFile, <span class="string">'file'</span>);
    hasGdata = exist(GdataFile, <span class="string">'file'</span>);

    <span class="comment">% Only proceed if at least one file exists</span>
    <span class="keyword">if</span> hasPdata || hasSdata || hasGdata
        <span class="comment">% Load available data</span>
        <span class="keyword">if</span> hasPdata
            Pdata = load(PdataFile);
            fprintf(<span class="string">'Loaded: %s\n'</span>, PdataFile);
        <span class="keyword">else</span>
            Pdata = [];
            fprintf(<span class="string">'Missing: %s\n'</span>, PdataFile);
        <span class="keyword">end</span>

        <span class="keyword">if</span> hasSdata
            Sdata = load(SdataFile);
            fprintf(<span class="string">'Loaded: %s\n'</span>, SdataFile);
        <span class="keyword">else</span>
            Sdata = [];
            fprintf(<span class="string">'Missing: %s\n'</span>, SdataFile);
        <span class="keyword">end</span>

        <span class="keyword">if</span> hasGdata
            Gdata = load(GdataFile);
            fprintf(<span class="string">'Loaded: %s\n'</span>, GdataFile);
        <span class="keyword">else</span>
            Gdata = [];
            fprintf(<span class="string">'Missing: %s\n'</span>, GdataFile);
        <span class="keyword">end</span>

        <span class="comment">% Call plotting function with available data</span>
        plotPhantomSimulation(Pdata, Sdata, Gdata, sprintf(<span class="string">'DataSet%d'</span>, i));
    <span class="keyword">else</span>
        fprintf(<span class="string">'Skipping dataset %d - no data files exist\n'</span>, i);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> plotPhantomSimulation(Pdata, Sdata, Gdata, figPrefix)

    <span class="comment">% Initialize flags for available data</span>
    hasPdata = ~isempty(Pdata);
    hasSdata = ~isempty(Sdata);
    hasGdata = ~isempty(Gdata);

    <span class="comment">% Phantom Desired and Actual</span>
    <span class="keyword">if</span> hasPdata
        PqDes = Pdata.Pdata(:,1:3);
        PqdDes = Pdata.Pdata(:,4:6);
        PqAct = Pdata.Pdata(:,7:9);
        PqdAct = Pdata.Pdata(:,10:12);
    <span class="keyword">end</span>

    <span class="comment">% Extract data</span>
    <span class="keyword">if</span> hasSdata
        Stime = Sdata.tOpt;
        <span class="keyword">if</span> hasPdata
            Ptime = linspace(0, Stime(end), length(PqAct));
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> hasGdata
        Gtime = Gdata.Hys;
    <span class="keyword">end</span>

    <span class="comment">% Simulation Desired and Actual</span>
    <span class="keyword">if</span> hasSdata
        SqDes = Sdata.yOpt(:,1:3);
        SqdDes = Sdata.yOpt(:,4:6);
        SqAct = Sdata.yOpt(:,7:9);
        SqdAct = Sdata.yOpt(:,10:12);
    <span class="keyword">end</span>

    <span class="comment">% Gain Data</span>
    <span class="keyword">if</span> hasGdata
        GqDes = Gdata.yOut1(:,1:3);
        GqdDes = Gdata.yOut1(:,4:6);
        GqAct = Gdata.yOut1(:,7:9);
        GqdAct = Gdata.yOut1(:,10:12);
    <span class="keyword">end</span>



    <span class="comment">% Get target points if available</span>
    <span class="keyword">if</span> hasSdata
        xTarget = Sdata.xTarget;
    <span class="keyword">else</span>
        xTarget = [];
    <span class="keyword">end</span>

    <span class="comment">% Calculate FK for available data</span>
    <span class="keyword">if</span> hasSdata
        [SxDes,SyDes,SzDes] = FK(SqDes(:,1),SqDes(:,2),SqDes(:,3));
        [SxAct,SyAct,SzAct] = FK(SqAct(:,1),SqAct(:,2),SqAct(:,3));
    <span class="keyword">end</span>

    <span class="keyword">if</span> hasPdata
        [PxAct,PyAct,PzAct] = FK(PqAct(:,1),PqAct(:,2),PqAct(:,3));
    <span class="keyword">end</span>

    <span class="keyword">if</span> hasGdata
        [GxDes,GyDes,GzDes] = FK(GqDes(:,1),GqDes(:,2),GqDes(:,3));
        [GxAct,GyAct,GzAct] = FK(GqAct(:,1),GqAct(:,2),GqAct(:,3));
    <span class="keyword">end</span>



    <span class="comment">% --- Calculate number of target points ---</span>
    <span class="keyword">if</span> ~isempty(xTarget)
        nTargets = size(xTarget, 1);  <span class="comment">% Number of target points</span>

        <span class="comment">% --- Initialize distance arrays ---</span>
        TargetMinSim = zeros(nTargets, 1);
        TargetMinPthm = zeros(nTargets, 1);
        TargetMinGain = zeros(nTargets, 1);

        <span class="comment">% --- Compute minimum distances to each target point ---</span>
        <span class="keyword">for</span> i = 1:nTargets
            <span class="comment">% Simulation trajectory vs target</span>
            <span class="keyword">if</span> hasSdata
                diffsSim = [SxAct, SyAct, SzAct] - xTarget(i, :);
                TargetMinSim(i) = min(sqrt(sum(diffsSim.^2, 2)));
            <span class="keyword">end</span>

            <span class="comment">% Phantom trajectory vs target</span>
            <span class="keyword">if</span> hasPdata
                diffsPthm = [PxAct, PyAct, PzAct] - xTarget(i, :);
                TargetMinPthm(i) = min(sqrt(sum(diffsPthm.^2, 2)));
            <span class="keyword">end</span>

            <span class="comment">% Gain trajectory vs target</span>
            <span class="keyword">if</span> hasGdata
                diffsGain = [GxAct, GyAct, GzAct] - xTarget(i, :);
                TargetMinGain(i) = min(sqrt(sum(diffsGain.^2, 2)));
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">else</span>
        nTargets = 0;
        TargetMinSim = [];
        TargetMinPthm = [];
        TargetMinGain = [];
    <span class="keyword">end</span>

    <span class="comment">% --- Begin Plotting ---</span>
    fig1 = figure; hold <span class="string">on</span>; grid <span class="string">on</span>; view(3);

    <span class="comment">% Initialize plot handles</span>
    plotHandles = [];
    plotLabels = {};

    <span class="comment">% Start and End Points</span>
    hStart = plot3(0, 0, 0, <span class="string">'o'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'MarkerSize'</span>, 5, <span class="string">'DisplayName'</span>, <span class="string">'Start Point'</span>);
    hEnd   = plot3(Sdata.xFinal(1),Sdata.xFinal(2),Sdata.xFinal(3), <span class="string">'o'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'MarkerSize'</span>, 5, <span class="string">'DisplayName'</span>, <span class="string">'End Point'</span>);
    plotHandles = [plotHandles, hStart, hEnd];
    plotLabels = [plotLabels, {<span class="string">'Start Point'</span>, <span class="string">'End Point'</span>}];

    <span class="comment">% Desired Position and Trajectories</span>
    <span class="keyword">if</span> hasSdata
        hDesired = plot3(SxDes, SyDes, SzDes, <span class="string">'b'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'DisplayName'</span>, <span class="string">'Desired Position'</span>);
        hSim     = plot3(SxAct, SyAct, SzAct, <span class="string">'r'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'DisplayName'</span>, <span class="string">'Simulation Trajectory'</span>);
        plotHandles = [plotHandles, hDesired, hSim];
        plotLabels = [plotLabels, {<span class="string">'Desired Position'</span>, <span class="string">'Simulation Trajectory'</span>}];
    <span class="keyword">end</span>

    <span class="keyword">if</span> hasPdata
        hPhantom = plot3(PxAct, PyAct, PzAct, <span class="string">'g'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'DisplayName'</span>, <span class="string">'Phantom Trajectory'</span>);
        plotHandles = [plotHandles, hPhantom];
        plotLabels = [plotLabels, {<span class="string">'Phantom Trajectory'</span>}];
    <span class="keyword">end</span>

    <span class="keyword">if</span> hasGdata
        hGain = plot3(GxAct, GyAct, GzAct, <span class="string">'m'</span>, <span class="string">'LineWidth'</span>, 2, <span class="string">'DisplayName'</span>, <span class="string">'Gain Trajectory'</span>);
        plotHandles = [plotHandles, hGain];
        plotLabels = [plotLabels, {<span class="string">'Gain Trajectory'</span>}];
    <span class="keyword">end</span>

    <span class="comment">% Target Points</span>
    <span class="keyword">if</span> ~isempty(xTarget)
        targetHandles = gobjects(nTargets,1);
        targetLabels = cell(nTargets,1);
        <span class="keyword">for</span> k = 1:nTargets
            <span class="comment">% Plot target point</span>
            targetHandles(k) = plot3(xTarget(k,1), xTarget(k,2), xTarget(k,3), <span class="string">'p'</span>, <span class="keyword">...</span>
                <span class="string">'MarkerSize'</span>, 12, <span class="string">'MarkerFaceColor'</span>, <span class="string">'k'</span>, <span class="keyword">...</span>
                <span class="string">'DisplayName'</span>, sprintf(<span class="string">'Target Point %d'</span>, k));

            <span class="comment">% Create target labels</span>
            targetLabels{k} = sprintf(<span class="string">'Target Point %d'</span>, k);
        <span class="keyword">end</span>
        plotHandles = [plotHandles, targetHandles(:)'];
        plotLabels = [plotLabels, targetLabels(:)'];
    <span class="keyword">else</span>
        targetHandles = [];
        targetLabels = {};
    <span class="keyword">end</span>

    <span class="comment">% Optional: Plot Control Points if they exist</span>
    <span class="keyword">if</span> hasSdata &amp;&amp; isfield(Sdata, <span class="string">'xCtrl'</span>)
        xCtrl = Sdata.xCtrl;
        hCtrl = plot3(xCtrl(:,1), xCtrl(:,2), xCtrl(:,3), <span class="string">'d'</span>, <span class="string">'LineWidth'</span>, 1.5, <span class="keyword">...</span>
            <span class="string">'MarkerSize'</span>, 6, <span class="string">'DisplayName'</span>, <span class="string">'Control Points'</span>);
        ctrlLabel = {<span class="string">'Control Points'</span>};
        ctrlHandles = hCtrl;
        plotHandles = [plotHandles, ctrlHandles];
        plotLabels = [plotLabels, ctrlLabel];
    <span class="keyword">else</span>
        ctrlLabel = {};
        ctrlHandles = [];
    <span class="keyword">end</span>

    <span class="comment">% --- Create Dummy Handles for Error Info (for legend) ---</span>
    errorHandles = [];
    errorLabels = {};

    <span class="keyword">if</span> ~isempty(xTarget)
        <span class="keyword">for</span> k = 1:nTargets
            <span class="keyword">if</span> hasSdata
                errorHandles(end+1) = plot(nan, nan, <span class="string">'w'</span>);  <span class="comment">% Invisible handle for Sim error</span>
                errorLabels{end+1} = sprintf(<span class="string">'Target %d Sim Err: %.6f'</span>, k, TargetMinSim(k));
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasPdata
                errorHandles(end+1) = plot(nan, nan, <span class="string">'w'</span>);    <span class="comment">% Invisible handle for Pthm error</span>
                errorLabels{end+1} = sprintf(<span class="string">'Target %d Pthm Err: %.6f'</span>, k, TargetMinPthm(k));
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasGdata
                errorHandles(end+1) = plot(nan, nan, <span class="string">'w'</span>);    <span class="comment">% Invisible handle for Gain error</span>
                errorLabels{end+1} = sprintf(<span class="string">'Target %d Gain Err: %.6f'</span>, k, TargetMinGain(k));
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% --- Build Full Legend ---</span>
    allHandles = [plotHandles, errorHandles];
    allLabels = [plotLabels, errorLabels];

    legend(allHandles, allLabels, <span class="string">'Location'</span>, <span class="string">'eastoutside'</span>);

    <span class="comment">% --- Axis Labels and Title ---</span>
    xlabel(<span class="string">'X axis (m)'</span>);
    ylabel(<span class="string">'Y axis (m)'</span>);
    zlabel(<span class="string">'Z axis (m)'</span>);
    title(<span class="string">'3D Cartesian Space Position'</span>);

    <span class="comment">% Save 3D trajectory figure as both PNG and FIG</span>
    saveas(fig1, sprintf(<span class="string">'%s_3D_Trajectory.png'</span>, figPrefix));
    saveas(fig1, sprintf(<span class="string">'%s_3D_Trajectory.fig'</span>, figPrefix));


    <span class="comment">% Joint Position Figure</span>
    <span class="keyword">if</span> hasPdata || hasSdata || hasGdata
        fig2 = figure;
        <span class="keyword">for</span> i = 1:3
            subplot(3,1,i); grid <span class="string">on</span>; hold <span class="string">on</span>;

            <span class="comment">% Initialize legend entries for this subplot</span>
            subplotHandles = [];
            subplotLabels = {};

            <span class="keyword">if</span> hasPdata
                plot(Ptime, PqAct(:,i), <span class="string">'r-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Phantom Actual</span>
                subplotHandles(end+1) = plot(Ptime, PqAct(:,i), <span class="string">'r-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Phantom Actual'</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasSdata
                plot(Stime, SqDes(:,i), <span class="string">'g-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Simulation Desired</span>
                plot(Stime, SqAct(:,i), <span class="string">'b-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Simulation Actual</span>
                subplotHandles(end+1) = plot(Stime, SqDes(:,i), <span class="string">'g-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotHandles(end+1) = plot(Stime, SqAct(:,i), <span class="string">'b-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Simulation Desired'</span>;
                subplotLabels{end+1} = <span class="string">'Simulation Actual'</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasGdata
                plot(Gtime, GqAct(:,i), <span class="string">'m-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Gain Actual</span>
                subplotHandles(end+1) = plot(Gtime, GqAct(:,i), <span class="string">'m-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Gain Actual'</span>;
            <span class="keyword">end</span>

            title(sprintf(<span class="string">'Joint %d Position'</span>, i));
            <span class="keyword">if</span> i == 3, xlabel(<span class="string">'Time'</span>); <span class="keyword">end</span>
            ylabel(<span class="string">'Position(rad)'</span>);
            legend(subplotHandles, subplotLabels);
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Save Joint Position figure as both PNG and FIG</span>
    saveas(fig2, sprintf(<span class="string">'%s_Joint_Position.png'</span>, figPrefix));
    saveas(fig2, sprintf(<span class="string">'%s_Joint_Position.fig'</span>, figPrefix));

    <span class="comment">% Joint Velocity Figure</span>
    <span class="keyword">if</span> hasPdata || hasSdata || hasGdata
        fig3 = figure;
        <span class="keyword">for</span> i = 1:3
            subplot(3,1,i); grid <span class="string">on</span>; hold <span class="string">on</span>;

            <span class="comment">% Initialize legend entries for this subplot</span>
            subplotHandles = [];
            subplotLabels = {};

            <span class="keyword">if</span> hasPdata
                plot(Ptime, PqdAct(:,i), <span class="string">'r-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Phantom Actual</span>
                subplotHandles(end+1) = plot(Ptime, PqdAct(:,i), <span class="string">'r-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Phantom Actual'</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasSdata
                plot(Stime, SqdDes(:,i), <span class="string">'g-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Simulation Desired</span>
                plot(Stime, SqdAct(:,i), <span class="string">'b-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Simulation Actual</span>
                subplotHandles(end+1) = plot(Stime, SqdDes(:,i), <span class="string">'g-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotHandles(end+1) = plot(Stime, SqdAct(:,i), <span class="string">'b-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Simulation Desired'</span>;
                subplotLabels{end+1} = <span class="string">'Simulation Actual'</span>;
            <span class="keyword">end</span>

            <span class="keyword">if</span> hasGdata
                plot(Gtime, GqdAct(:,i), <span class="string">'m-'</span>, <span class="string">'LineWidth'</span>, 1.2);    <span class="comment">% Gain Actual</span>
                subplotHandles(end+1) = plot(Gtime, GqdAct(:,i), <span class="string">'m-'</span>, <span class="string">'LineWidth'</span>, 1.2);
                subplotLabels{end+1} = <span class="string">'Gain Actual'</span>;
            <span class="keyword">end</span>

            title(sprintf(<span class="string">'Joint %d Velocity'</span>, i));
            <span class="keyword">if</span> i == 3, xlabel(<span class="string">'Time'</span>); <span class="keyword">end</span>
            ylabel(<span class="string">'Velocity rad/s'</span>);
            legend(subplotHandles, subplotLabels);
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Save Joint Velocity figure as both PNG and FIG</span>
    saveas(fig3, sprintf(<span class="string">'%s_Joint_Velocity.png'</span>, figPrefix));
    saveas(fig3, sprintf(<span class="string">'%s_Joint_Velocity.fig'</span>, figPrefix));
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">Loaded: Pdata1.mat
Loaded: Sdata1.mat
Missing: Gdata1.mat
Loaded: Pdata2.mat
Loaded: Sdata2.mat
Missing: Gdata2.mat
Loaded: Pdata3.mat
Loaded: Sdata3.mat
Missing: Gdata3.mat
Loaded: Pdata4.mat
Loaded: Sdata4.mat
Missing: Gdata4.mat
Loaded: Pdata5.mat
Loaded: Sdata5.mat
Missing: Gdata5.mat
Loaded: Pdata6.mat
Loaded: Sdata6.mat
Missing: Gdata6.mat
Loaded: Pdata7.mat
Loaded: Sdata7.mat
Missing: Gdata7.mat
</pre>
<img vspace="5" hspace="5" src="dataPlotting_01.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_02.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_03.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_04.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_05.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_06.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_07.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_08.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_09.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_10.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_11.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_12.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_13.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_14.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_15.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_16.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_17.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_18.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_19.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_20.png" alt=""> <img vspace="5" hspace="5" src="dataPlotting_21.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
close all
% publish('dataPlotting.m', 'html');
for i = 1:7
    % Construct filenames
    PdataFile = sprintf('Pdata%d.mat', i);
    SdataFile = sprintf('Sdata%d.mat', i);
    GdataFile = sprintf('Gdata%d.mat', i);
    
    % Check which files exist
    hasPdata = exist(PdataFile, 'file');
    hasSdata = exist(SdataFile, 'file');
    hasGdata = exist(GdataFile, 'file');
    
    % Only proceed if at least one file exists
    if hasPdata || hasSdata || hasGdata
        % Load available data
        if hasPdata
            Pdata = load(PdataFile);
            fprintf('Loaded: %s\n', PdataFile);
        else
            Pdata = [];
            fprintf('Missing: %s\n', PdataFile);
        end
        
        if hasSdata
            Sdata = load(SdataFile);
            fprintf('Loaded: %s\n', SdataFile);
        else
            Sdata = [];
            fprintf('Missing: %s\n', SdataFile);
        end
        
        if hasGdata
            Gdata = load(GdataFile);
            fprintf('Loaded: %s\n', GdataFile);
        else
            Gdata = [];
            fprintf('Missing: %s\n', GdataFile);
        end
        
        % Call plotting function with available data
        plotPhantomSimulation(Pdata, Sdata, Gdata, sprintf('DataSet%d', i));
    else
        fprintf('Skipping dataset %d - no data files exist\n', i);
    end
end

function plotPhantomSimulation(Pdata, Sdata, Gdata, figPrefix)
    
    % Initialize flags for available data
    hasPdata = ~isempty(Pdata);
    hasSdata = ~isempty(Sdata);
    hasGdata = ~isempty(Gdata);
    
    % Phantom Desired and Actual 
    if hasPdata
        PqDes = Pdata.Pdata(:,1:3);
        PqdDes = Pdata.Pdata(:,4:6);
        PqAct = Pdata.Pdata(:,7:9);
        PqdAct = Pdata.Pdata(:,10:12);
    end

    % Extract data
    if hasSdata
        Stime = Sdata.tOpt;
        if hasPdata
            Ptime = linspace(0, Stime(end), length(PqAct));
        end
    end
    
    if hasGdata
        Gtime = Gdata.Hys;
    end

    % Simulation Desired and Actual 
    if hasSdata
        SqDes = Sdata.yOpt(:,1:3);
        SqdDes = Sdata.yOpt(:,4:6);
        SqAct = Sdata.yOpt(:,7:9);
        SqdAct = Sdata.yOpt(:,10:12);
    end
    
    % Gain Data
    if hasGdata
        GqDes = Gdata.yOut1(:,1:3);
        GqdDes = Gdata.yOut1(:,4:6);
        GqAct = Gdata.yOut1(:,7:9);
        GqdAct = Gdata.yOut1(:,10:12);
    end



    % Get target points if available
    if hasSdata
        xTarget = Sdata.xTarget;
    else
        xTarget = [];
    end
    
    % Calculate FK for available data
    if hasSdata
        [SxDes,SyDes,SzDes] = FK(SqDes(:,1),SqDes(:,2),SqDes(:,3));
        [SxAct,SyAct,SzAct] = FK(SqAct(:,1),SqAct(:,2),SqAct(:,3));
    end
    
    if hasPdata
        [PxAct,PyAct,PzAct] = FK(PqAct(:,1),PqAct(:,2),PqAct(:,3));
    end
    
    if hasGdata
        [GxDes,GyDes,GzDes] = FK(GqDes(:,1),GqDes(:,2),GqDes(:,3));
        [GxAct,GyAct,GzAct] = FK(GqAct(:,1),GqAct(:,2),GqAct(:,3));
    end



    % REPLACE_WITH_DASH_DASH- Calculate number of target points REPLACE_WITH_DASH_DASH-
    if ~isempty(xTarget)
        nTargets = size(xTarget, 1);  % Number of target points
        
        % REPLACE_WITH_DASH_DASH- Initialize distance arrays REPLACE_WITH_DASH_DASH-
        TargetMinSim = zeros(nTargets, 1);
        TargetMinPthm = zeros(nTargets, 1);
        TargetMinGain = zeros(nTargets, 1);
        
        % REPLACE_WITH_DASH_DASH- Compute minimum distances to each target point REPLACE_WITH_DASH_DASH-
        for i = 1:nTargets
            % Simulation trajectory vs target
            if hasSdata
                diffsSim = [SxAct, SyAct, SzAct] - xTarget(i, :);
                TargetMinSim(i) = min(sqrt(sum(diffsSim.^2, 2)));
            end
        
            % Phantom trajectory vs target
            if hasPdata
                diffsPthm = [PxAct, PyAct, PzAct] - xTarget(i, :);
                TargetMinPthm(i) = min(sqrt(sum(diffsPthm.^2, 2)));
            end

            % Gain trajectory vs target
            if hasGdata
                diffsGain = [GxAct, GyAct, GzAct] - xTarget(i, :);
                TargetMinGain(i) = min(sqrt(sum(diffsGain.^2, 2)));
            end
        end
    else
        nTargets = 0;
        TargetMinSim = [];
        TargetMinPthm = [];
        TargetMinGain = [];
    end
    
    % REPLACE_WITH_DASH_DASH- Begin Plotting REPLACE_WITH_DASH_DASH-
    fig1 = figure; hold on; grid on; view(3);
    
    % Initialize plot handles
    plotHandles = [];
    plotLabels = {};
    
    % Start and End Points
    hStart = plot3(0, 0, 0, 'o', 'LineWidth', 2, 'MarkerSize', 5, 'DisplayName', 'Start Point');
    hEnd   = plot3(Sdata.xFinal(1),Sdata.xFinal(2),Sdata.xFinal(3), 'o', 'LineWidth', 2, 'MarkerSize', 5, 'DisplayName', 'End Point');
    plotHandles = [plotHandles, hStart, hEnd];
    plotLabels = [plotLabels, {'Start Point', 'End Point'}];
    
    % Desired Position and Trajectories
    if hasSdata
        hDesired = plot3(SxDes, SyDes, SzDes, 'b', 'LineWidth', 2, 'DisplayName', 'Desired Position');
        hSim     = plot3(SxAct, SyAct, SzAct, 'r', 'LineWidth', 2, 'DisplayName', 'Simulation Trajectory');
        plotHandles = [plotHandles, hDesired, hSim];
        plotLabels = [plotLabels, {'Desired Position', 'Simulation Trajectory'}];
    end
    
    if hasPdata
        hPhantom = plot3(PxAct, PyAct, PzAct, 'g', 'LineWidth', 2, 'DisplayName', 'Phantom Trajectory');
        plotHandles = [plotHandles, hPhantom];
        plotLabels = [plotLabels, {'Phantom Trajectory'}];
    end
    
    if hasGdata
        hGain = plot3(GxAct, GyAct, GzAct, 'm', 'LineWidth', 2, 'DisplayName', 'Gain Trajectory');
        plotHandles = [plotHandles, hGain];
        plotLabels = [plotLabels, {'Gain Trajectory'}];
    end
    
    % Target Points
    if ~isempty(xTarget)
        targetHandles = gobjects(nTargets,1);
        targetLabels = cell(nTargets,1);
        for k = 1:nTargets
            % Plot target point
            targetHandles(k) = plot3(xTarget(k,1), xTarget(k,2), xTarget(k,3), 'p', ...
                'MarkerSize', 12, 'MarkerFaceColor', 'k', ...
                'DisplayName', sprintf('Target Point %d', k));
            
            % Create target labels
            targetLabels{k} = sprintf('Target Point %d', k);
        end
        plotHandles = [plotHandles, targetHandles(:)'];
        plotLabels = [plotLabels, targetLabels(:)'];
    else
        targetHandles = [];
        targetLabels = {};
    end
    
    % Optional: Plot Control Points if they exist
    if hasSdata && isfield(Sdata, 'xCtrl')
        xCtrl = Sdata.xCtrl;
        hCtrl = plot3(xCtrl(:,1), xCtrl(:,2), xCtrl(:,3), 'd', 'LineWidth', 1.5, ...
            'MarkerSize', 6, 'DisplayName', 'Control Points');
        ctrlLabel = {'Control Points'};
        ctrlHandles = hCtrl;
        plotHandles = [plotHandles, ctrlHandles];
        plotLabels = [plotLabels, ctrlLabel];
    else
        ctrlLabel = {};
        ctrlHandles = [];
    end
    
    % REPLACE_WITH_DASH_DASH- Create Dummy Handles for Error Info (for legend) REPLACE_WITH_DASH_DASH-
    errorHandles = [];
    errorLabels = {};
    
    if ~isempty(xTarget)
        for k = 1:nTargets
            if hasSdata
                errorHandles(end+1) = plot(nan, nan, 'w');  % Invisible handle for Sim error
                errorLabels{end+1} = sprintf('Target %d Sim Err: %.6f', k, TargetMinSim(k));
            end
        
            if hasPdata
                errorHandles(end+1) = plot(nan, nan, 'w');    % Invisible handle for Pthm error
                errorLabels{end+1} = sprintf('Target %d Pthm Err: %.6f', k, TargetMinPthm(k));
            end

            if hasGdata
                errorHandles(end+1) = plot(nan, nan, 'w');    % Invisible handle for Gain error
                errorLabels{end+1} = sprintf('Target %d Gain Err: %.6f', k, TargetMinGain(k));
            end
        end
    end
    
    % REPLACE_WITH_DASH_DASH- Build Full Legend REPLACE_WITH_DASH_DASH-
    allHandles = [plotHandles, errorHandles];
    allLabels = [plotLabels, errorLabels];
    
    legend(allHandles, allLabels, 'Location', 'eastoutside');
    
    % REPLACE_WITH_DASH_DASH- Axis Labels and Title REPLACE_WITH_DASH_DASH-
    xlabel('X axis (m)');
    ylabel('Y axis (m)');
    zlabel('Z axis (m)');
    title('3D Cartesian Space Position');
    
    % Save 3D trajectory figure as both PNG and FIG
    saveas(fig1, sprintf('%s_3D_Trajectory.png', figPrefix));
    saveas(fig1, sprintf('%s_3D_Trajectory.fig', figPrefix));


    % Joint Position Figure
    if hasPdata || hasSdata || hasGdata
        fig2 = figure;
        for i = 1:3
            subplot(3,1,i); grid on; hold on;
            
            % Initialize legend entries for this subplot
            subplotHandles = [];
            subplotLabels = {};
            
            if hasPdata
                plot(Ptime, PqAct(:,i), 'r-', 'LineWidth', 1.2);    % Phantom Actual
                subplotHandles(end+1) = plot(Ptime, PqAct(:,i), 'r-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Phantom Actual';
            end
            
            if hasSdata
                plot(Stime, SqDes(:,i), 'g-', 'LineWidth', 1.2);    % Simulation Desired
                plot(Stime, SqAct(:,i), 'b-', 'LineWidth', 1.2);    % Simulation Actual
                subplotHandles(end+1) = plot(Stime, SqDes(:,i), 'g-', 'LineWidth', 1.2);
                subplotHandles(end+1) = plot(Stime, SqAct(:,i), 'b-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Simulation Desired';
                subplotLabels{end+1} = 'Simulation Actual';
            end
            
            if hasGdata
                plot(Gtime, GqAct(:,i), 'm-', 'LineWidth', 1.2);    % Gain Actual
                subplotHandles(end+1) = plot(Gtime, GqAct(:,i), 'm-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Gain Actual';
            end

            title(sprintf('Joint %d Position', i));
            if i == 3, xlabel('Time'); end
            ylabel('Position(rad)');
            legend(subplotHandles, subplotLabels);
        end
    end
    
    % Save Joint Position figure as both PNG and FIG
    saveas(fig2, sprintf('%s_Joint_Position.png', figPrefix));
    saveas(fig2, sprintf('%s_Joint_Position.fig', figPrefix));

    % Joint Velocity Figure
    if hasPdata || hasSdata || hasGdata
        fig3 = figure;
        for i = 1:3
            subplot(3,1,i); grid on; hold on;
            
            % Initialize legend entries for this subplot
            subplotHandles = [];
            subplotLabels = {};
            
            if hasPdata
                plot(Ptime, PqdAct(:,i), 'r-', 'LineWidth', 1.2);    % Phantom Actual
                subplotHandles(end+1) = plot(Ptime, PqdAct(:,i), 'r-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Phantom Actual';
            end
            
            if hasSdata
                plot(Stime, SqdDes(:,i), 'g-', 'LineWidth', 1.2);    % Simulation Desired
                plot(Stime, SqdAct(:,i), 'b-', 'LineWidth', 1.2);    % Simulation Actual
                subplotHandles(end+1) = plot(Stime, SqdDes(:,i), 'g-', 'LineWidth', 1.2);
                subplotHandles(end+1) = plot(Stime, SqdAct(:,i), 'b-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Simulation Desired';
                subplotLabels{end+1} = 'Simulation Actual';
            end
            
            if hasGdata
                plot(Gtime, GqdAct(:,i), 'm-', 'LineWidth', 1.2);    % Gain Actual
                subplotHandles(end+1) = plot(Gtime, GqdAct(:,i), 'm-', 'LineWidth', 1.2);
                subplotLabels{end+1} = 'Gain Actual';
            end

            title(sprintf('Joint %d Velocity', i));
            if i == 3, xlabel('Time'); end
            ylabel('Velocity rad/s');
            legend(subplotHandles, subplotLabels);
        end
    end

    % Save Joint Velocity figure as both PNG and FIG
    saveas(fig3, sprintf('%s_Joint_Velocity.png', figPrefix));
    saveas(fig3, sprintf('%s_Joint_Velocity.fig', figPrefix));
end


##### SOURCE END #####
-->
</body>
</html>
